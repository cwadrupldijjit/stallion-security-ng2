System.register([], function(exports_1) {
    var slimScroll;
    return {
        setters:[],
        execute: function() {
            slimScroll = function (C, payload) {
                console.log('run');
                var i = {}, w = "wrapper", s = "scrollBar", S = "scrollBarContainer", a = "", m = "", l = "data-slimscroll", 
                // properties
                oT = "offsetTop", sT = "scrollTop", pE = "parentElement", pes = "previousElementSibling", iH = "innerHTML", cT = "currentTarget", sK = "scroll-k", U = "%", d = ".", 
                // IE8 properties
                assignValues = function (k) {
                    var q = i.E;
                    i.h = i[S].offsetHeight;
                    i.sH = i[w].scrollHeight;
                    i.sP = (i.h / i.sH) * 100;
                    // i.sbh is scroll bar height in pixels without pixel unit.
                    i.sbh = i.sP * i.h / 100;
                    // Manually set the height of the scrollbar (in percentage)
                    // if user hasn't provided the fixed scroll height value
                    if (!q.sH)
                        i.sP1 = i.sbh < q.mH ? (q.mH / i.h * 100) : i.sP;
                    else
                        i.sP1 = q.sH / i.h * 100;
                    i.rP1 = 100 - i.sP1;
                    i.x = (i.sH - i.h) * ((i.sP1 - i.sP) / (100 - i.sP));
                    i.sH1 = Math.abs((i.x / (i.rP1)) + (i.sH / 100));
                    i[s].style.height = i.sP1 + U;
                    i.reposition = getReposition(i[s], i.h);
                }, 
                // Start of private functions
                setAttr = function (e, p, v) {
                    e.setAttribute(p, v);
                }, getAttr = function (e, p) {
                    if (!e)
                        return;
                    return e.getAttribute(p);
                }, addClass = function (e, c) {
                    if (c.length)
                        e.className = c;
                }, cE = function (c, h, p) {
                    var d = document.createElement('div');
                    addClass(d, c);
                    d[iH] = h;
                    p.appendChild(d);
                    return d;
                }, setScroll = function (e) {
                    var e = e || event, el = e.target, p = el[pE];
                    var q = i.E;
                    if (!i || p === i[S])
                        return;
                    var eY = e.pageY || event.clientY, top = ((eY - getTop(i[w][pE])) / i.h * 100) - i.sP1 / 2;
                    if (top > i.rP1)
                        top = i.rP1;
                    else if (top < 0)
                        top = 0;
                    i[s].style.top = top + U;
                    i[w][sT] = top * i.sH1;
                    addClass(i[S], q.S + q.a);
                }, beginScroll = function (e) {
                    // removing selected text
                    // Link: http://stackoverflow.com/a/3171348
                    var sel = window.getSelection ? window.getSelection() : document.selection;
                    if (sel) {
                        if (sel.removeAllRanges)
                            sel.removeAllRanges();
                        else if (sel.empty)
                            sel.empty();
                    }
                    var e = e || event, el = e[cT];
                    addEvent('mousemove', document, moveScroll);
                    addEvent('mouseup', document, endScroll);
                    i[oT] = getTop(i[w]);
                    i.firstY = e.pageY || event.clientY;
                    if (!i.reposition)
                        i.reposition = getReposition(i[s], i.h);
                    // Disable text selection while dragging the scrollbar
                    return false;
                }, getReposition = function (i, h) {
                    var x = parseInt(i.style.top.replace(U, ""), 10) * h / 100;
                    return x ? x : 0;
                }, moveScroll = function (e) {
                    var e = e || event, q = i.E, eY = e.pageY || e.clientY, top = (i.reposition + eY - i.firstY) / i.h * 100;
                    if (i.rP1 < top)
                        top = i.rP1;
                    if (!i.previousTop)
                        i.previousTop = top + 1;
                    var blnThreshold = top >= 0 && i.firstY > i[oT];
                    if ((i.previousTop > top && blnThreshold) || (blnThreshold && (i[w][sT] + i.h !== i.sH))) {
                        i[s].style.top = top + U;
                        i.previousTop = top;
                        i[w][sT] = top * i.sH1;
                    }
                    addClass(i[S], q.S);
                }, endScroll = function (e) {
                    var e = e || event, q = i.E;
                    removeEvent('mousemove', document);
                    removeEvent('mouseup', document);
                    i.reposition = 0;
                    addClass(i[S], q.S + q.a);
                }, doScroll = function (e) {
                    var e = e || event;
                    if (!i)
                        return;
                    var q = i.E;
                    addClass(i[S], q.S);
                    i[s].style.top = i[w][sT] / i.sH1 + U;
                    addClass(i[S], q.S + q.a);
                }, addEvent = function (e, el, func) {
                    el['on' + e] = func;
                    // el.addEventListener(e, func, false);
                }, removeEvent = function (e, el) {
                    el['on' + e] = null;
                    // el.removeEventListener(e, func, false);
                }, addCSSRule = function (S, s, r, i) {
                    if (S.insertRule)
                        S.insertRule(s + "{" + r + "}", i);
                    else if (S.addRule)
                        S.addRule(s, r, i);
                }, getTop = function (el) {
                    var t = document.documentElement[sT];
                    return el.getBoundingClientRect().top + (t ? t : document.body[sT]);
                }, insertCss = function () {
                    if (slimScroll.inserted) {
                        return;
                    }
                    // Inserting css rules
                    // Link: http://davidwalsh.name/add-rules-stylesheets
                    var slim = "[" + l + "]", imp = " !important", pA = "position:absolute" + imp, 
                    // classes
                    w = pA + ";overflow:auto" + imp + ";left:0px;top:0px" + imp + ";right:-18px;bottom:0px" + imp + ";padding-right:8px" + imp + ";", S = pA + ";top:0px" + imp + ";bottom:0px" + imp + ";right:0px;left:auto;width:5px;cursor:pointer" + imp + ";padding-right:0px" + imp + ";", s = pA + ";background-color:#999;top:0px;left:0px;right:0px;", 
                    //creating a sheet
                    style = document.createElement('style'), scrollBar = "[data-scrollbar]";
                    try {
                        // WebKit hack :(
                        style.appendChild(document.createTextNode(""));
                    }
                    catch (ex) { }
                    var head = document.head || document.getElementsByTagName('head')[0];
                    // adding above css to the sheet
                    head.insertBefore(style, (head.hasChildNodes())
                        ? head.childNodes[0]
                        : null);
                    var sheet = style.sheet;
                    if (sheet) {
                        addCSSRule(sheet, slim + ">div", w, 0);
                        addCSSRule(sheet, slim + ">div+div", S, 0);
                        addCSSRule(sheet, scrollBar, s, 0);
                    }
                    else {
                        style.styleSheet.cssText = slim + ">div{" + w + "}" + slim + ">div+div" + "{" + S + "}" + slim + ">div+div>div{" + s + "}";
                    }
                    slimScroll.inserted = true;
                }, 
                // Initial function
                init = function () {
                    C.removeAttribute(l); //reset
                    if (C.offsetHeight < C.scrollHeight) {
                        setAttr(C, l, '1');
                        insertCss();
                        var h = C[iH], q = i.E = {};
                        // setting user defined classes
                        payload = payload || {};
                        q.w = payload.wrapperClass || "";
                        q.s = payload.scrollBarClass || "";
                        q.S = payload.scrollBarContainerClass || "";
                        q.a = payload.scrollBarContainerSpecialClass ? " " + payload.scrollBarContainerSpecialClass : "";
                        q.mH = payload.scrollBarMinHeight || 25;
                        q.sH = payload.scrollBarFixedHeight; // could be undefined
                        C[iH] = "";
                        i[w] = cE(q.w, h, C);
                        i[S] = cE(q.S + q.a, "", C);
                        i[s] = cE(q.s, "", i[S]);
                        setAttr(i[s], 'data-scrollbar', '1');
                        assignValues();
                        if (payload.keepFocus) {
                            setAttr(i[w], 'tabindex', '-1');
                            i[w].focus();
                        }
                        // Attaching mouse events
                        addEvent('mousedown', i[s], beginScroll);
                        addEvent('click', i[S], setScroll);
                        // For scroll
                        addEvent('scroll', i[w], doScroll);
                    }
                }();
                return {
                    resetValues: assignValues
                };
            };
            exports_1("slimScroll", slimScroll);
        }
    }
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9zbGltc2Nyb2xsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7UUFBSSxVQUFVOzs7O1lBQVYsVUFBVSxHQUFHLFVBQVMsQ0FBYyxFQUFFLE9BQU87Z0JBQ2hELE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ2hCLElBQUksQ0FBQyxHQUFHLEVBQUUsRUFDTixDQUFDLEdBQUcsU0FBUyxFQUFDLENBQUMsR0FBRyxXQUFXLEVBQUMsQ0FBQyxHQUFHLG9CQUFvQixFQUFDLENBQUMsR0FBRyxFQUFFLEVBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBQyxDQUFDLEdBQUMsaUJBQWlCO2dCQUN4RixhQUFhO2dCQUNiLEVBQUUsR0FBRyxXQUFXLEVBQUMsRUFBRSxHQUFHLFdBQVcsRUFBQyxFQUFFLEdBQUcsZUFBZSxFQUFDLEdBQUcsR0FBRSx3QkFBd0IsRUFDcEYsRUFBRSxHQUFHLFdBQVcsRUFBQyxFQUFFLEdBQUcsZUFBZSxFQUFDLEVBQUUsR0FBRyxVQUFVLEVBQUMsQ0FBQyxHQUFHLEdBQUcsRUFBQyxDQUFDLEdBQUcsR0FBRztnQkFDckUsaUJBQWlCO2dCQUNqQixZQUFZLEdBQUcsVUFBUyxDQUFFO29CQUN0QixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUNaLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQztvQkFDeEIsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDO29CQUN6QixDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsR0FBRyxDQUFDO29CQUN4QiwyREFBMkQ7b0JBQzNELENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFDLEdBQUcsQ0FBQztvQkFDdkIsMkRBQTJEO29CQUMzRCx3REFBd0Q7b0JBQ3hELEVBQUUsQ0FBQSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQzt3QkFBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLEdBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsR0FBRSxDQUFDLENBQUMsRUFBRSxDQUFDO29CQUN2RCxJQUFJO3dCQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQztvQkFFNUIsQ0FBQyxDQUFDLEdBQUcsR0FBRyxHQUFHLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQztvQkFDcEIsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztvQkFDbkQsQ0FBQyxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO29CQUMvQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQztvQkFFOUIsQ0FBQyxDQUFDLFVBQVUsR0FBRyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDNUMsQ0FBQztnQkFDRCw2QkFBNkI7Z0JBQzdCLE9BQU8sR0FBRyxVQUFTLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQztvQkFDdEIsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3hCLENBQUMsRUFDRCxPQUFPLEdBQUcsVUFBUyxDQUFDLEVBQUUsQ0FBQztvQkFDbkIsRUFBRSxDQUFBLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQUMsTUFBTSxDQUFDO29CQUNkLE1BQU0sQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUM3QixDQUFDLEVBQ0QsUUFBUSxHQUFHLFVBQVMsQ0FBQyxFQUFFLENBQUM7b0JBQ3BCLEVBQUUsQ0FBQSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUM7d0JBQUMsQ0FBQyxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUM7Z0JBQ2pDLENBQUMsRUFDRCxFQUFFLEdBQUcsVUFBUyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUM7b0JBQ2pCLElBQUksQ0FBQyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7b0JBQ3RDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7b0JBQ2YsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQztvQkFDVixDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUNqQixNQUFNLENBQUMsQ0FBQyxDQUFDO2dCQUNiLENBQUMsRUFDRCxTQUFTLEdBQUcsVUFBUyxDQUFDO29CQUNsQixJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksS0FBSyxFQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsTUFBTSxFQUM1QixDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO29CQUNmLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBRVosRUFBRSxDQUFBLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFBQyxNQUFNLENBQUM7b0JBQzVCLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQyxLQUFLLElBQUksS0FBSyxDQUFDLE9BQU8sRUFDN0IsR0FBRyxHQUFHLENBQUMsQ0FBQyxFQUFFLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxHQUFDLENBQUMsQ0FBQztvQkFDeEQsRUFBRSxDQUFBLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUM7d0JBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUM7b0JBQzVCLElBQUksQ0FBQyxFQUFFLENBQUEsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDO3dCQUFDLEdBQUcsR0FBRyxDQUFDLENBQUM7b0JBQ3pCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUM7b0JBQ3pCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQztvQkFDdkIsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDOUIsQ0FBQyxFQUNELFdBQVcsR0FBRyxVQUFTLENBQUM7b0JBQ3BCLHlCQUF5QjtvQkFDekIsMkNBQTJDO29CQUMzQyxJQUFJLEdBQUcsR0FBRyxNQUFNLENBQUMsWUFBWSxHQUFHLE1BQU0sQ0FBQyxZQUFZLEVBQUUsR0FBRyxRQUFRLENBQUMsU0FBUyxDQUFDO29CQUMzRSxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO3dCQUNOLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUM7NEJBQUMsR0FBRyxDQUFDLGVBQWUsRUFBRSxDQUFDO3dCQUMvQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQzs0QkFBQyxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7b0JBQ3BDLENBQUM7b0JBQ0QsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEtBQUssRUFDZCxFQUFFLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO29CQUVmLFFBQVEsQ0FBQyxXQUFXLEVBQUUsUUFBUSxFQUFFLFVBQVUsQ0FBQyxDQUFDO29CQUM1QyxRQUFRLENBQUMsU0FBUyxFQUFFLFFBQVEsRUFBRSxTQUFTLENBQUMsQ0FBQztvQkFFekMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDckIsQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsS0FBSyxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUM7b0JBQ3BDLEVBQUUsQ0FBQSxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQzt3QkFBQyxDQUFDLENBQUMsVUFBVSxHQUFHLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUMxRCxzREFBc0Q7b0JBQ3RELE1BQU0sQ0FBQyxLQUFLLENBQUM7Z0JBQ2pCLENBQUMsRUFDRCxhQUFhLEdBQUcsVUFBUyxDQUFDLEVBQUUsQ0FBQztvQkFDekIsSUFBSSxDQUFDLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUMsRUFBRSxDQUFDLEVBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxHQUFDLEdBQUcsQ0FBQztvQkFDdkQsTUFBTSxDQUFDLENBQUMsR0FBQyxDQUFDLEdBQUMsQ0FBQyxDQUFDO2dCQUNqQixDQUFDLEVBQ0QsVUFBVSxHQUFHLFVBQVMsQ0FBQztvQkFDbkIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEtBQUssRUFDZCxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFDUCxFQUFFLEdBQUcsQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsT0FBTyxFQUN6QixHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsVUFBVSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLEdBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUM7b0JBRW5ELEVBQUUsQ0FBQSxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDO3dCQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDO29CQUM1QixFQUFFLENBQUEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUM7d0JBQUMsQ0FBQyxDQUFDLFdBQVcsR0FBRyxHQUFHLEdBQUcsQ0FBQyxDQUFDO29CQUMzQyxJQUFJLFlBQVksR0FBRyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO29CQUNoRCxFQUFFLENBQUEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLEdBQUcsR0FBRyxJQUFJLFlBQVksQ0FBQyxJQUFJLENBQUMsWUFBWSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQSxDQUFDO3dCQUNyRixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsR0FBRyxHQUFHLEdBQUcsQ0FBQyxDQUFDO3dCQUN6QixDQUFDLENBQUMsV0FBVyxHQUFHLEdBQUcsQ0FBQzt3QkFDcEIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDO29CQUMzQixDQUFDO29CQUNELFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN4QixDQUFDLEVBQ0QsU0FBUyxHQUFHLFVBQVMsQ0FBQztvQkFDbEIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEtBQUssRUFBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFFM0IsV0FBVyxDQUFDLFdBQVcsRUFBRSxRQUFRLENBQUMsQ0FBQztvQkFDbkMsV0FBVyxDQUFDLFNBQVMsRUFBRSxRQUFRLENBQUMsQ0FBQztvQkFFakMsQ0FBQyxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUM7b0JBQ2pCLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzlCLENBQUMsRUFDRCxRQUFRLEdBQUcsVUFBUyxDQUFDO29CQUNqQixJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksS0FBSyxDQUFDO29CQUNuQixFQUFFLENBQUEsQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFBQyxNQUFNLENBQUM7b0JBQ2QsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDWixRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDcEIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDO29CQUNwQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUM5QixDQUFDLEVBQ0QsUUFBUSxHQUFHLFVBQVMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxJQUFJO29CQUMzQixFQUFFLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQztvQkFDcEIsdUNBQXVDO2dCQUMzQyxDQUFDLEVBQ0QsV0FBVyxHQUFHLFVBQVMsQ0FBQyxFQUFFLEVBQUU7b0JBQ3hCLEVBQUUsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDO29CQUNwQiwwQ0FBMEM7Z0JBQzlDLENBQUMsRUFDRCxVQUFVLEdBQUcsVUFBUyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDO29CQUM1QixFQUFFLENBQUEsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDO3dCQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO29CQUNwRCxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQzt3QkFBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQzFDLENBQUMsRUFDRCxNQUFNLEdBQUcsVUFBUyxFQUFFO29CQUNoQixJQUFJLENBQUMsR0FBRyxRQUFRLENBQUMsZUFBZSxDQUFDLEVBQUUsQ0FBQyxDQUFDO29CQUNyQyxNQUFNLENBQUMsRUFBRSxDQUFDLHFCQUFxQixFQUFFLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxHQUFDLENBQUMsR0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQ3BFLENBQUMsRUFDRCxTQUFTLEdBQUc7b0JBQ1IsRUFBRSxDQUFBLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxDQUFBLENBQUM7d0JBQ3BCLE1BQU0sQ0FBQztvQkFDWCxDQUFDO29CQUNELHNCQUFzQjtvQkFDdEIscURBQXFEO29CQUNyRCxJQUFJLElBQUksR0FBRyxHQUFHLEdBQUMsQ0FBQyxHQUFDLEdBQUcsRUFDaEIsR0FBRyxHQUFHLGFBQWEsRUFDbkIsRUFBRSxHQUFHLG1CQUFtQixHQUFDLEdBQUc7b0JBQzVCLFVBQVU7b0JBQ1YsQ0FBQyxHQUFHLEVBQUUsR0FBQyxnQkFBZ0IsR0FBQyxHQUFHLEdBQUMsbUJBQW1CLEdBQUMsR0FBRyxHQUFDLHlCQUF5QixHQUFDLEdBQUcsR0FBQyxvQkFBb0IsR0FBQyxHQUFHLEdBQUMsR0FBRyxFQUM5RyxDQUFDLEdBQUcsRUFBRSxHQUFDLFVBQVUsR0FBQyxHQUFHLEdBQUMsYUFBYSxHQUFDLEdBQUcsR0FBQywrQ0FBK0MsR0FBQyxHQUFHLEdBQUMsb0JBQW9CLEdBQUMsR0FBRyxHQUFDLEdBQUcsRUFDeEgsQ0FBQyxHQUFHLEVBQUUsR0FBQyxvREFBb0Q7b0JBQzNELGtCQUFrQjtvQkFDbEIsS0FBSyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLEVBQ3ZDLFNBQVMsR0FBRyxrQkFBa0IsQ0FBQztvQkFDbkMsSUFBRyxDQUFDO3dCQUNBLGlCQUFpQjt3QkFDakIsS0FBSyxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7b0JBQ25ELENBQUM7b0JBQUEsS0FBSyxDQUFBLENBQUMsRUFBRSxDQUFDLENBQUEsQ0FBQyxDQUFBLENBQUM7b0JBRVosSUFBSSxJQUFJLEdBQUksUUFBUSxDQUFDLElBQUksSUFBSSxRQUFRLENBQUMsb0JBQW9CLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBRXRFLGdDQUFnQztvQkFDaEMsSUFBSSxDQUFDLFlBQVksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7MEJBQ3pCLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDOzBCQUNsQixJQUFJLENBQUMsQ0FBQztvQkFDNUIsSUFBSSxLQUFLLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQztvQkFDeEIsRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDLENBQUEsQ0FBQzt3QkFDTixVQUFVLENBQUMsS0FBSyxFQUFFLElBQUksR0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO3dCQUNyQyxVQUFVLENBQUMsS0FBSyxFQUFFLElBQUksR0FBQyxVQUFVLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO3dCQUN6QyxVQUFVLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7b0JBQ3ZDLENBQUM7b0JBQ0QsSUFBSSxDQUFBLENBQUM7d0JBQ0QsS0FBSyxDQUFDLFVBQVUsQ0FBQyxPQUFPLEdBQUcsSUFBSSxHQUFDLE9BQU8sR0FBQyxDQUFDLEdBQUMsR0FBRyxHQUFDLElBQUksR0FBQyxVQUFVLEdBQUMsR0FBRyxHQUFDLENBQUMsR0FBQyxHQUFHLEdBQUMsSUFBSSxHQUFDLGVBQWUsR0FBQyxDQUFDLEdBQUMsR0FBRyxDQUFDO29CQUN2RyxDQUFDO29CQUNELFVBQVUsQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO2dCQUMvQixDQUFDO2dCQUNELG1CQUFtQjtnQkFDbkIsSUFBSSxHQUFHO29CQUNILENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBRSxPQUFPO29CQUM5QixFQUFFLENBQUEsQ0FBQyxDQUFDLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQSxDQUFDO3dCQUNoQyxPQUFPLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQzt3QkFDbkIsU0FBUyxFQUFFLENBQUM7d0JBQ1osSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQzt3QkFDNUIsK0JBQStCO3dCQUMvQixPQUFPLEdBQUcsT0FBTyxJQUFJLEVBQUUsQ0FBQzt3QkFDeEIsQ0FBQyxDQUFDLENBQUMsR0FBRyxPQUFPLENBQUMsWUFBWSxJQUFJLEVBQUUsQ0FBQzt3QkFDakMsQ0FBQyxDQUFDLENBQUMsR0FBRyxPQUFPLENBQUMsY0FBYyxJQUFJLEVBQUUsQ0FBQzt3QkFDbkMsQ0FBQyxDQUFDLENBQUMsR0FBRyxPQUFPLENBQUMsdUJBQXVCLElBQUksRUFBRSxDQUFDO3dCQUM1QyxDQUFDLENBQUMsQ0FBQyxHQUFHLE9BQU8sQ0FBQyw4QkFBOEIsR0FBRyxHQUFHLEdBQUcsT0FBTyxDQUFDLDhCQUE4QixHQUFHLEVBQUUsQ0FBQzt3QkFDakcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxPQUFPLENBQUMsa0JBQWtCLElBQUksRUFBRSxDQUFDO3dCQUN4QyxDQUFDLENBQUMsRUFBRSxHQUFHLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQyxDQUFFLHFCQUFxQjt3QkFFM0QsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQzt3QkFDWCxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO3dCQUNyQixDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7d0JBQzVCLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQ3pCLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsZ0JBQWdCLEVBQUUsR0FBRyxDQUFDLENBQUM7d0JBQ3JDLFlBQVksRUFBRSxDQUFDO3dCQUVmLEVBQUUsQ0FBQSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQSxDQUFDOzRCQUNsQixPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLFVBQVUsRUFBRSxJQUFJLENBQUMsQ0FBQzs0QkFDaEMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDO3dCQUNqQixDQUFDO3dCQUNELHlCQUF5Qjt3QkFDekIsUUFBUSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsV0FBVyxDQUFDLENBQUM7d0JBQ3pDLFFBQVEsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLFNBQVMsQ0FBQyxDQUFDO3dCQUNuQyxhQUFhO3dCQUNiLFFBQVEsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUFDO29CQUV2QyxDQUFDO2dCQUNMLENBQUMsRUFBRSxDQUFDO2dCQUNSLE1BQU0sQ0FBQztvQkFDSCxXQUFXLEVBQUUsWUFBWTtpQkFDNUIsQ0FBQTtZQUNMLENBQUMsQ0FBQztZQUVPLG1DQUFVIiwiZmlsZSI6ImFwcC9zbGltc2Nyb2xsLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIHNsaW1TY3JvbGwgPSBmdW5jdGlvbihDOiBIVE1MRWxlbWVudCwgcGF5bG9hZCl7XG5cdGNvbnNvbGUubG9nKCdydW4nKTtcbiAgICB2YXIgaSA9IHt9LFxuICAgICAgICB3ID0gXCJ3cmFwcGVyXCIscyA9IFwic2Nyb2xsQmFyXCIsUyA9IFwic2Nyb2xsQmFyQ29udGFpbmVyXCIsYSA9IFwiXCIsbSA9IFwiXCIsbD1cImRhdGEtc2xpbXNjcm9sbFwiLFxuICAgICAgICAvLyBwcm9wZXJ0aWVzXG4gICAgICAgIG9UID0gXCJvZmZzZXRUb3BcIixzVCA9IFwic2Nyb2xsVG9wXCIscEUgPSBcInBhcmVudEVsZW1lbnRcIixwZXM9IFwicHJldmlvdXNFbGVtZW50U2libGluZ1wiLCBcbiAgICAgICAgaUggPSBcImlubmVySFRNTFwiLGNUID0gXCJjdXJyZW50VGFyZ2V0XCIsc0sgPSBcInNjcm9sbC1rXCIsVSA9IFwiJVwiLGQgPSBcIi5cIixcbiAgICAgICAgLy8gSUU4IHByb3BlcnRpZXNcbiAgICAgICAgYXNzaWduVmFsdWVzID0gZnVuY3Rpb24oaz8pe1xuICAgICAgICAgICAgdmFyIHEgPSBpLkU7XG4gICAgICAgICAgICBpLmggPSBpW1NdLm9mZnNldEhlaWdodDtcbiAgICAgICAgICAgIGkuc0ggPSBpW3ddLnNjcm9sbEhlaWdodDtcbiAgICAgICAgICAgIGkuc1AgPSAoaS5oL2kuc0gpICogMTAwO1xuICAgICAgICAgICAgLy8gaS5zYmggaXMgc2Nyb2xsIGJhciBoZWlnaHQgaW4gcGl4ZWxzIHdpdGhvdXQgcGl4ZWwgdW5pdC5cbiAgICAgICAgICAgIGkuc2JoID0gaS5zUCAqIGkuaC8xMDA7XG4gICAgICAgICAgICAvLyBNYW51YWxseSBzZXQgdGhlIGhlaWdodCBvZiB0aGUgc2Nyb2xsYmFyIChpbiBwZXJjZW50YWdlKVxuICAgICAgICAgICAgLy8gaWYgdXNlciBoYXNuJ3QgcHJvdmlkZWQgdGhlIGZpeGVkIHNjcm9sbCBoZWlnaHQgdmFsdWVcbiAgICAgICAgICAgIGlmKCFxLnNIKSBpLnNQMSA9IGkuc2JoIDwgcS5tSD8gKHEubUgvaS5oICogMTAwKTogaS5zUDtcbiAgICAgICAgICAgIGVsc2UgaS5zUDEgPSBxLnNIL2kuaCAqIDEwMDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaS5yUDEgPSAxMDAgLSBpLnNQMTtcbiAgICAgICAgICAgIGkueCA9IChpLnNIIC0gaS5oKSAqICgoaS5zUDEgLSBpLnNQKS8oMTAwIC0gaS5zUCkpO1xuICAgICAgICAgICAgaS5zSDEgPSBNYXRoLmFicygoaS54IC8gKGkuclAxKSkgKyAoaS5zSC8xMDApKTtcbiAgICAgICAgICAgIGlbc10uc3R5bGUuaGVpZ2h0ID0gaS5zUDEgKyBVO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpLnJlcG9zaXRpb24gPSBnZXRSZXBvc2l0aW9uKGlbc10sIGkuaCk7XG4gICAgICAgIH0sXG4gICAgICAgIC8vIFN0YXJ0IG9mIHByaXZhdGUgZnVuY3Rpb25zXG4gICAgICAgIHNldEF0dHIgPSBmdW5jdGlvbihlLCBwLCB2KXtcbiAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKHAsdik7XG4gICAgICAgIH0sXG4gICAgICAgIGdldEF0dHIgPSBmdW5jdGlvbihlLCBwKXtcbiAgICAgICAgICAgIGlmKCFlKSByZXR1cm47XG4gICAgICAgICAgICByZXR1cm4gZS5nZXRBdHRyaWJ1dGUocCk7ICAgICAgICAgICAgXG4gICAgICAgIH0sXG4gICAgICAgIGFkZENsYXNzID0gZnVuY3Rpb24oZSwgYyl7XG4gICAgICAgICAgICBpZihjLmxlbmd0aCkgZS5jbGFzc05hbWUgPSBjO1xuICAgICAgICB9LFxuICAgICAgICBjRSA9IGZ1bmN0aW9uKGMsIGgsIHApe1xuICAgICAgICAgICAgdmFyIGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIGFkZENsYXNzKGQsIGMpO1xuICAgICAgICAgICAgZFtpSF0gPSBoO1xuICAgICAgICAgICAgcC5hcHBlbmRDaGlsZChkKTtcbiAgICAgICAgICAgIHJldHVybiBkO1xuICAgICAgICB9LFxuICAgICAgICBzZXRTY3JvbGwgPSBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgIHZhciBlID0gZSB8fCBldmVudCxlbCA9IGUudGFyZ2V0LFxuICAgICAgICAgICAgICAgIHAgPSBlbFtwRV07XG4gICAgICAgICAgICB2YXIgcSA9IGkuRTtcblxuICAgICAgICAgICAgaWYoIWkgfHwgcCA9PT0gaVtTXSkgcmV0dXJuO1xuICAgICAgICAgICAgdmFyIGVZID0gZS5wYWdlWSB8fCBldmVudC5jbGllbnRZLFxuICAgICAgICAgICAgICAgIHRvcCA9ICgoZVkgLSBnZXRUb3AoaVt3XVtwRV0pKS9pLmggKiAxMDApIC0gaS5zUDEvMjtcbiAgICAgICAgICAgIGlmKHRvcCA+IGkuclAxKSB0b3AgPSBpLnJQMTtcbiAgICAgICAgICAgIGVsc2UgaWYodG9wIDwgMCkgdG9wID0gMDtcbiAgICAgICAgICAgIGlbc10uc3R5bGUudG9wID0gdG9wICsgVTtcbiAgICAgICAgICAgIGlbd11bc1RdID0gdG9wICogaS5zSDE7XG4gICAgICAgICAgICBhZGRDbGFzcyhpW1NdLCBxLlMgKyBxLmEpO1xuICAgICAgICB9LFxuICAgICAgICBiZWdpblNjcm9sbCA9IGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgLy8gcmVtb3Zpbmcgc2VsZWN0ZWQgdGV4dFxuICAgICAgICAgICAgLy8gTGluazogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL2EvMzE3MTM0OFxuICAgICAgICAgICAgdmFyIHNlbCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24gPyB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkgOiBkb2N1bWVudC5zZWxlY3Rpb247XG4gICAgICAgICAgICBpZiAoc2VsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNlbC5yZW1vdmVBbGxSYW5nZXMpIHNlbC5yZW1vdmVBbGxSYW5nZXMoKTtcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChzZWwuZW1wdHkpIHNlbC5lbXB0eSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGUgPSBlIHx8IGV2ZW50LFxuICAgICAgICAgICAgICAgIGVsID0gZVtjVF07XG5cbiAgICAgICAgICAgIGFkZEV2ZW50KCdtb3VzZW1vdmUnLCBkb2N1bWVudCwgbW92ZVNjcm9sbCk7XG4gICAgICAgICAgICBhZGRFdmVudCgnbW91c2V1cCcsIGRvY3VtZW50LCBlbmRTY3JvbGwpO1xuXG4gICAgICAgICAgICBpW29UXSA9IGdldFRvcChpW3ddKTtcbiAgICAgICAgICAgIGkuZmlyc3RZID0gZS5wYWdlWSB8fCBldmVudC5jbGllbnRZO1xuICAgICAgICAgICAgaWYoIWkucmVwb3NpdGlvbikgaS5yZXBvc2l0aW9uID0gZ2V0UmVwb3NpdGlvbihpW3NdLCBpLmgpO1xuICAgICAgICAgICAgLy8gRGlzYWJsZSB0ZXh0IHNlbGVjdGlvbiB3aGlsZSBkcmFnZ2luZyB0aGUgc2Nyb2xsYmFyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0sXG4gICAgICAgIGdldFJlcG9zaXRpb24gPSBmdW5jdGlvbihpLCBoKXtcbiAgICAgICAgICAgIHZhciB4ID0gcGFyc2VJbnQoaS5zdHlsZS50b3AucmVwbGFjZShVLFwiXCIpLDEwKSAqIGgvMTAwO1xuICAgICAgICAgICAgcmV0dXJuIHg/eDowO1xuICAgICAgICB9LFxuICAgICAgICBtb3ZlU2Nyb2xsID0gZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICB2YXIgZSA9IGUgfHwgZXZlbnQsXG4gICAgICAgICAgICAgICAgcSA9IGkuRSxcbiAgICAgICAgICAgICAgICBlWSA9IGUucGFnZVkgfHwgZS5jbGllbnRZLFxuICAgICAgICAgICAgICAgIHRvcCA9IChpLnJlcG9zaXRpb24gKyBlWSAtIGkuZmlyc3RZKS9pLmggKiAxMDA7XG5cbiAgICAgICAgICAgIGlmKGkuclAxIDwgdG9wKSB0b3AgPSBpLnJQMTtcbiAgICAgICAgICAgIGlmKCFpLnByZXZpb3VzVG9wKSBpLnByZXZpb3VzVG9wID0gdG9wICsgMTtcbiAgICAgICAgICAgIHZhciBibG5UaHJlc2hvbGQgPSB0b3AgPj0gMCAmJiBpLmZpcnN0WSA+IGlbb1RdO1xuICAgICAgICAgICAgaWYoKGkucHJldmlvdXNUb3AgPiB0b3AgJiYgYmxuVGhyZXNob2xkKSB8fCAoYmxuVGhyZXNob2xkICYmIChpW3ddW3NUXSArIGkuaCAhPT0gaS5zSCkpKXtcbiAgICAgICAgICAgICAgICBpW3NdLnN0eWxlLnRvcCA9IHRvcCArIFU7XG4gICAgICAgICAgICAgICAgaS5wcmV2aW91c1RvcCA9IHRvcDsgICBcbiAgICAgICAgICAgICAgICBpW3ddW3NUXSA9IHRvcCAqIGkuc0gxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYWRkQ2xhc3MoaVtTXSwgcS5TKTtcbiAgICAgICAgfSxcbiAgICAgICAgZW5kU2Nyb2xsID0gZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICB2YXIgZSA9IGUgfHwgZXZlbnQscSA9IGkuRTsgXG5cbiAgICAgICAgICAgIHJlbW92ZUV2ZW50KCdtb3VzZW1vdmUnLCBkb2N1bWVudCk7XG4gICAgICAgICAgICByZW1vdmVFdmVudCgnbW91c2V1cCcsIGRvY3VtZW50KTtcblxuICAgICAgICAgICAgaS5yZXBvc2l0aW9uID0gMDtcbiAgICAgICAgICAgIGFkZENsYXNzKGlbU10sIHEuUyArIHEuYSk7XG4gICAgICAgIH0sXG4gICAgICAgIGRvU2Nyb2xsID0gZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICB2YXIgZSA9IGUgfHwgZXZlbnQ7XG4gICAgICAgICAgICBpZighaSkgcmV0dXJuO1xuICAgICAgICAgICAgdmFyIHEgPSBpLkU7XG4gICAgICAgICAgICBhZGRDbGFzcyhpW1NdLCBxLlMpO1xuICAgICAgICAgICAgaVtzXS5zdHlsZS50b3AgPSBpW3ddW3NUXS9pLnNIMSArIFU7XG4gICAgICAgICAgICBhZGRDbGFzcyhpW1NdLCBxLlMgKyBxLmEpO1xuICAgICAgICB9LFxuICAgICAgICBhZGRFdmVudCA9IGZ1bmN0aW9uKGUsIGVsLCBmdW5jKXtcbiAgICAgICAgICAgIGVsWydvbicgKyBlXSA9IGZ1bmM7XG4gICAgICAgICAgICAvLyBlbC5hZGRFdmVudExpc3RlbmVyKGUsIGZ1bmMsIGZhbHNlKTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVtb3ZlRXZlbnQgPSBmdW5jdGlvbihlLCBlbCl7XG4gICAgICAgICAgICBlbFsnb24nICsgZV0gPSBudWxsO1xuICAgICAgICAgICAgLy8gZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihlLCBmdW5jLCBmYWxzZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGFkZENTU1J1bGUgPSBmdW5jdGlvbihTLCBzLCByLCBpKSB7XG4gICAgICAgICAgICBpZihTLmluc2VydFJ1bGUpIFMuaW5zZXJ0UnVsZShzICsgXCJ7XCIgKyByICsgXCJ9XCIsIGkpO1xuICAgICAgICAgICAgZWxzZSBpZihTLmFkZFJ1bGUpIFMuYWRkUnVsZShzLCByLCBpKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0VG9wID0gZnVuY3Rpb24oZWwpe1xuICAgICAgICAgICAgdmFyIHQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnRbc1RdO1xuICAgICAgICAgICAgcmV0dXJuIGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCArICh0P3Q6ZG9jdW1lbnQuYm9keVtzVF0pO1xuICAgICAgICB9LFxuICAgICAgICBpbnNlcnRDc3MgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgaWYoc2xpbVNjcm9sbC5pbnNlcnRlZCl7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gSW5zZXJ0aW5nIGNzcyBydWxlc1xuICAgICAgICAgICAgLy8gTGluazogaHR0cDovL2Rhdmlkd2Fsc2gubmFtZS9hZGQtcnVsZXMtc3R5bGVzaGVldHNcbiAgICAgICAgICAgIHZhciBzbGltID0gXCJbXCIrbCtcIl1cIixcbiAgICAgICAgICAgICAgICBpbXAgPSBcIiAhaW1wb3J0YW50XCIsXG4gICAgICAgICAgICAgICAgcEEgPSBcInBvc2l0aW9uOmFic29sdXRlXCIraW1wLFxuICAgICAgICAgICAgICAgIC8vIGNsYXNzZXNcbiAgICAgICAgICAgICAgICB3ID0gcEErXCI7b3ZlcmZsb3c6YXV0b1wiK2ltcCtcIjtsZWZ0OjBweDt0b3A6MHB4XCIraW1wK1wiO3JpZ2h0Oi0xOHB4O2JvdHRvbTowcHhcIitpbXArXCI7cGFkZGluZy1yaWdodDo4cHhcIitpbXArXCI7XCIsXG4gICAgICAgICAgICAgICAgUyA9IHBBK1wiO3RvcDowcHhcIitpbXArXCI7Ym90dG9tOjBweFwiK2ltcCtcIjtyaWdodDowcHg7bGVmdDphdXRvO3dpZHRoOjVweDtjdXJzb3I6cG9pbnRlclwiK2ltcCtcIjtwYWRkaW5nLXJpZ2h0OjBweFwiK2ltcCtcIjtcIixcbiAgICAgICAgICAgICAgICBzID0gcEErXCI7YmFja2dyb3VuZC1jb2xvcjojOTk5O3RvcDowcHg7bGVmdDowcHg7cmlnaHQ6MHB4O1wiLFxuICAgICAgICAgICAgICAgIC8vY3JlYXRpbmcgYSBzaGVldFxuICAgICAgICAgICAgICAgIHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKSxcbiAgICAgICAgICAgICAgICBzY3JvbGxCYXIgPSBcIltkYXRhLXNjcm9sbGJhcl1cIjtcbiAgICAgICAgICAgIHRyeXtcbiAgICAgICAgICAgICAgICAvLyBXZWJLaXQgaGFjayA6KFxuICAgICAgICAgICAgICAgIHN0eWxlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKFwiXCIpKTtcbiAgICAgICAgICAgIH1jYXRjaChleCl7fVxuICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIgaGVhZCA9ICBkb2N1bWVudC5oZWFkIHx8IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkJylbMF07XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBhZGRpbmcgYWJvdmUgY3NzIHRvIHRoZSBzaGVldFxuICAgICAgICAgICAgaGVhZC5pbnNlcnRCZWZvcmUoc3R5bGUsIChoZWFkLmhhc0NoaWxkTm9kZXMoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBoZWFkLmNoaWxkTm9kZXNbMF1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBudWxsKTtcbiAgICAgICAgICAgIHZhciBzaGVldCA9IHN0eWxlLnNoZWV0O1xuICAgICAgICAgICAgaWYoc2hlZXQpeyAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBhZGRDU1NSdWxlKHNoZWV0LCBzbGltK1wiPmRpdlwiLCB3LCAwKTtcbiAgICAgICAgICAgICAgICBhZGRDU1NSdWxlKHNoZWV0LCBzbGltK1wiPmRpditkaXZcIiwgUywgMCk7XG4gICAgICAgICAgICAgICAgYWRkQ1NTUnVsZShzaGVldCwgc2Nyb2xsQmFyLCBzLCAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2V7XG4gICAgICAgICAgICAgICAgc3R5bGUuc3R5bGVTaGVldC5jc3NUZXh0ID0gc2xpbStcIj5kaXZ7XCIrdytcIn1cIitzbGltK1wiPmRpditkaXZcIitcIntcIitTK1wifVwiK3NsaW0rXCI+ZGl2K2Rpdj5kaXZ7XCIrcytcIn1cIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNsaW1TY3JvbGwuaW5zZXJ0ZWQgPSB0cnVlO1xuICAgICAgICB9LFxuICAgICAgICAvLyBJbml0aWFsIGZ1bmN0aW9uXG4gICAgICAgIGluaXQgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgQy5yZW1vdmVBdHRyaWJ1dGUobCk7ICAvL3Jlc2V0XG4gICAgICAgICAgICBpZihDLm9mZnNldEhlaWdodCA8IEMuc2Nyb2xsSGVpZ2h0KXtcbiAgICAgICAgICAgICAgICBzZXRBdHRyKEMsIGwsICcxJyk7XG4gICAgICAgICAgICAgICAgaW5zZXJ0Q3NzKCk7XG4gICAgICAgICAgICAgICAgdmFyIGggPSBDW2lIXSwgcSA9IGkuRSA9IHt9O1xuICAgICAgICAgICAgICAgIC8vIHNldHRpbmcgdXNlciBkZWZpbmVkIGNsYXNzZXNcbiAgICAgICAgICAgICAgICBwYXlsb2FkID0gcGF5bG9hZCB8fCB7fTtcbiAgICAgICAgICAgICAgICBxLncgPSBwYXlsb2FkLndyYXBwZXJDbGFzcyB8fCBcIlwiO1xuICAgICAgICAgICAgICAgIHEucyA9IHBheWxvYWQuc2Nyb2xsQmFyQ2xhc3MgfHwgXCJcIjtcbiAgICAgICAgICAgICAgICBxLlMgPSBwYXlsb2FkLnNjcm9sbEJhckNvbnRhaW5lckNsYXNzIHx8IFwiXCI7XG4gICAgICAgICAgICAgICAgcS5hID0gcGF5bG9hZC5zY3JvbGxCYXJDb250YWluZXJTcGVjaWFsQ2xhc3MgPyBcIiBcIiArIHBheWxvYWQuc2Nyb2xsQmFyQ29udGFpbmVyU3BlY2lhbENsYXNzIDogXCJcIjtcbiAgICAgICAgICAgICAgICBxLm1IID0gcGF5bG9hZC5zY3JvbGxCYXJNaW5IZWlnaHQgfHwgMjU7XG4gICAgICAgICAgICAgICAgcS5zSCA9IHBheWxvYWQuc2Nyb2xsQmFyRml4ZWRIZWlnaHQ7ICAvLyBjb3VsZCBiZSB1bmRlZmluZWRcblxuICAgICAgICAgICAgICAgIENbaUhdID0gXCJcIjtcbiAgICAgICAgICAgICAgICBpW3ddID0gY0UocS53LCBoLCBDKTtcbiAgICAgICAgICAgICAgICBpW1NdID0gY0UocS5TICsgcS5hLCBcIlwiLCBDKTtcbiAgICAgICAgICAgICAgICBpW3NdID0gY0UocS5zLCBcIlwiLCBpW1NdKTtcbiAgICAgICAgICAgICAgICBzZXRBdHRyKGlbc10sICdkYXRhLXNjcm9sbGJhcicsICcxJyk7XG4gICAgICAgICAgICAgICAgYXNzaWduVmFsdWVzKCk7XG5cbiAgICAgICAgICAgICAgICBpZihwYXlsb2FkLmtlZXBGb2N1cyl7XG4gICAgICAgICAgICAgICAgICAgIHNldEF0dHIoaVt3XSwgJ3RhYmluZGV4JywgJy0xJyk7XG4gICAgICAgICAgICAgICAgICAgIGlbd10uZm9jdXMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gQXR0YWNoaW5nIG1vdXNlIGV2ZW50c1xuICAgICAgICAgICAgICAgIGFkZEV2ZW50KCdtb3VzZWRvd24nLCBpW3NdLCBiZWdpblNjcm9sbCk7XG4gICAgICAgICAgICAgICAgYWRkRXZlbnQoJ2NsaWNrJywgaVtTXSwgc2V0U2Nyb2xsKTtcbiAgICAgICAgICAgICAgICAvLyBGb3Igc2Nyb2xsXG4gICAgICAgICAgICAgICAgYWRkRXZlbnQoJ3Njcm9sbCcsIGlbd10sIGRvU2Nyb2xsKTtcbiAgICAgICAgICAgICAgICAvLyBhZGRFdmVudCgnc2VsZWN0c3RhcnQnLCBpW1NdLCBmdW5jdGlvbigpe3JldHVybjt9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSgpO1xuICAgIHJldHVybiB7XG4gICAgICAgIHJlc2V0VmFsdWVzOiBhc3NpZ25WYWx1ZXNcbiAgICB9XG59O1xuXG5leHBvcnQgeyBzbGltU2Nyb2xsIH07Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
