System.register([], function(exports_1) {
    var slimScroll;
    return {
        setters:[],
        execute: function() {
            slimScroll = function (C, payload) {
                console.log('run');
                var i = {}, w = "wrapper", s = "scrollBar", S = "scrollBarContainer", a = "", m = "", l = "data-slimscroll", 
                // properties
                oT = "offsetTop", sT = "scrollTop", pE = "parentElement", pes = "previousElementSibling", unit = "%", 
                // IE8 properties
                assignValues = function (k) {
                    var q = i.E;
                    i.h = i.scrollBarContainer.offsetHeight;
                    i.sH = i.wrapper.scrollHeight;
                    i.sP = (i.h / i.sH) * 100;
                    // i.sbh is scroll bar height in pixels without pixel unit.
                    i.sbh = i.sP * i.h / 100;
                    // Manually set the height of the scrollbar (in percentage)
                    // if user hasn't provided the fixed scroll height value
                    if (!q.sH)
                        i.sP1 = i.sbh < q.mH ? (q.mH / i.h * 100) : i.sP;
                    else
                        i.sP1 = q.sH / i.h * 100;
                    i.rP1 = 100 - i.sP1;
                    i.x = (i.sH - i.h) * ((i.sP1 - i.sP) / (100 - i.sP));
                    i.sH1 = Math.abs((i.x / (i.rP1)) + (i.sH / 100));
                    i.scrollBar.style.height = i.sP1 + unit;
                    i.reposition = getReposition(i.scrollBar, i.h);
                }, 
                // Start of private functions
                setAttr = function (e, p, v) {
                    e.setAttribute(p, v);
                }, getAttr = function (e, p) {
                    if (!e)
                        return;
                    return e.getAttribute(p);
                }, addClass = function (e, c) {
                    if (c.length)
                        e.className = c;
                }, cE = function (c, h, p) {
                    var d = document.createElement('div');
                    addClass(d, c);
                    d.innerHTML = h;
                    p.appendChild(d);
                    return d;
                }, setScroll = function (e) {
                    var e = e || event, el = e.target, p = el[pE];
                    var q = i.E;
                    if (!i || p === i.scrollBarContainer)
                        return;
                    var eY = e.pageY || event.clientY, top = ((eY - getTop(i.wrapper[pE])) / i.h * 100) - i.sP1 / 2;
                    if (top > i.rP1)
                        top = i.rP1;
                    else if (top < 0)
                        top = 0;
                    i.scrollBar.style.top = top + unit;
                    i.wrapper[sT] = top * i.sH1;
                    addClass(i.scrollBarContainer, q.S + q.a);
                }, beginScroll = function (e) {
                    // removing selected text
                    // Link: http://stackoverflow.com/a/3171348
                    var sel = window.getSelection ? window.getSelection() : document.selection;
                    if (sel) {
                        if (sel.removeAllRanges)
                            sel.removeAllRanges();
                        else if (sel.empty)
                            sel.empty();
                    }
                    var e = e || event, el = e.currentTarget;
                    addEvent('mousemove', document, moveScroll);
                    addEvent('mouseup', document, endScroll);
                    i[oT] = getTop(i.wrapper);
                    i.firstY = e.pageY || event.clientY;
                    if (!i.reposition)
                        i.reposition = getReposition(i.scrollBar, i.h);
                    // Disable text selection while dragging the scrollbar
                    return false;
                }, getReposition = function (i, h) {
                    var x = parseInt(i.style.top.replace(unit, ""), 10) * h / 100;
                    return x ? x : 0;
                }, moveScroll = function (e) {
                    var e = e || event, q = i.E, eY = e.pageY || e.clientY, top = (i.reposition + eY - i.firstY) / i.h * 100;
                    if (i.rP1 < top)
                        top = i.rP1;
                    if (!i.previousTop)
                        i.previousTop = top + 1;
                    var blnThreshold = top >= 0 && i.firstY > i[oT];
                    if ((i.previousTop > top && blnThreshold) || (blnThreshold && (i.wrapper[sT] + i.h !== i.sH))) {
                        i.scrollBar.style.top = top + unit;
                        i.previousTop = top;
                        i.wrapper[sT] = top * i.sH1;
                    }
                    addClass(i.scrollBarContainer, q.S);
                }, endScroll = function (e) {
                    var e = e || event, q = i.E;
                    removeEvent('mousemove', document);
                    removeEvent('mouseup', document);
                    i.reposition = 0;
                    addClass(i.scrollBarContainer, q.S + q.a);
                }, doScroll = function (e) {
                    var e = e || event;
                    if (!i)
                        return;
                    var q = i.E;
                    addClass(i.scrollBarContainer, q.S);
                    i.scrollBar.style.top = i.wrapper[sT] / i.sH1 + unit;
                    addClass(i.scrollBarContainer, q.S + q.a);
                }, addEvent = function (e, el, func) {
                    el['on' + e] = func;
                    // el.addEventListener(e, func, false);
                }, removeEvent = function (e, el) {
                    el['on' + e] = null;
                    // el.removeEventListener(e, func, false);
                }, addCSSRule = function (S, s, r, i) {
                    if (S.insertRule)
                        S.insertRule(s + "{" + r + "}", i);
                    else if (S.addRule)
                        S.addRule(s, r, i);
                }, getTop = function (el) {
                    var t = document.documentElement[sT];
                    return el.getBoundingClientRect().top + (t ? t : document.body[sT]);
                }, insertCss = function () {
                    if (slimScroll.inserted) {
                        return;
                    }
                    // Inserting css rules
                    // Link: http://davidwalsh.name/add-rules-stylesheets
                    var slim = "[" + l + "]", imp = " !important", pA = "position:absolute" + imp, 
                    // classes
                    w = pA + ";overflow:auto" + imp + ";left:0px;top:0px" + imp + ";right:-18px;bottom:0px" + imp + ";padding-right:8px" + imp + ";", S = pA + ";top:0px" + imp + ";bottom:0px" + imp + ";right:0px;left:auto;width:5px;cursor:pointer" + imp + ";padding-right:0px" + imp + ";", s = pA + ";background-color:#999;top:0px;left:0px;right:0px;", 
                    //creating a sheet
                    style = document.createElement('style'), scrollBar = "[data-scrollbar]";
                    try {
                        // WebKit hack :(
                        style.appendChild(document.createTextNode(""));
                    }
                    catch (ex) { }
                    var head = document.head || document.getElementsByTagName('head')[0];
                    // adding above css to the sheet
                    head.insertBefore(style, (head.hasChildNodes())
                        ? head.childNodes[0]
                        : null);
                    var sheet = style.sheet;
                    if (sheet) {
                        addCSSRule(sheet, slim + ">div", w, 0);
                        addCSSRule(sheet, slim + ">div+div", S, 0);
                        addCSSRule(sheet, scrollBar, s, 0);
                    }
                    else {
                        style.styleSheet.cssText = slim + ">div{" + w + "}" + slim + ">div+div" + "{" + S + "}" + slim + ">div+div>div{" + s + "}";
                    }
                    slimScroll.inserted = true;
                }, 
                // Initial function
                init = function () {
                    C.removeAttribute(l); //reset
                    if (C.offsetHeight < C.scrollHeight) {
                        setAttr(C, l, '1');
                        insertCss();
                        var h = C.innerHTML, q = i.E = {};
                        // setting user defined classes
                        payload = payload || {};
                        q.w = payload.wrapperClass || "";
                        q.s = payload.scrollBarClass || "";
                        q.S = payload.scrollBarContainerClass || "";
                        q.a = payload.scrollBarContainerSpecialClass ? " " + payload.scrollBarContainerSpecialClass : "";
                        q.mH = payload.scrollBarMinHeight || 25;
                        q.sH = payload.scrollBarFixedHeight; // could be undefined
                        C.innerHTML = "";
                        i.wrapper = cE(q.w, h, C);
                        i.scrollBarContainer = cE(q.S + q.a, "", C);
                        i.scrollBar = cE(q.s, "", i.scrollBarContainer);
                        setAttr(i.scrollBar, 'data-scrollbar', '1');
                        assignValues();
                        if (payload.keepFocus) {
                            setAttr(i.wrapper, 'tabindex', '-1');
                            i.wrapper.focus();
                        }
                        // Attaching mouse events
                        addEvent('mousedown', i.scrollBar, beginScroll);
                        addEvent('click', i.scrollBarContainer, setScroll);
                        // For scroll
                        addEvent('scroll', i.wrapper, doScroll);
                    }
                }();
                return {
                    resetValues: assignValues
                };
            };
            exports_1("slimScroll", slimScroll);
        }
    }
});

//# sourceMappingURL=data:application/json;base64,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ImFwcC9zbGltc2Nyb2xsLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIHNsaW1TY3JvbGwgPSBmdW5jdGlvbihDOiBIVE1MRWxlbWVudCwgcGF5bG9hZCl7XG5cdGNvbnNvbGUubG9nKCdydW4nKTtcbiAgICB2YXIgaSA9IHt9LFxuICAgICAgICB3ID0gXCJ3cmFwcGVyXCIscyA9IFwic2Nyb2xsQmFyXCIsUyA9IFwic2Nyb2xsQmFyQ29udGFpbmVyXCIsYSA9IFwiXCIsbSA9IFwiXCIsbD1cImRhdGEtc2xpbXNjcm9sbFwiLFxuICAgICAgICAvLyBwcm9wZXJ0aWVzXG4gICAgICAgIG9UID0gXCJvZmZzZXRUb3BcIixzVCA9IFwic2Nyb2xsVG9wXCIscEUgPSBcInBhcmVudEVsZW1lbnRcIixwZXM9IFwicHJldmlvdXNFbGVtZW50U2libGluZ1wiLCBcbiAgICAgICAgdW5pdCA9IFwiJVwiLFxuICAgICAgICAvLyBJRTggcHJvcGVydGllc1xuICAgICAgICBhc3NpZ25WYWx1ZXMgPSBmdW5jdGlvbihrPyl7XG4gICAgICAgICAgICB2YXIgcSA9IGkuRTtcbiAgICAgICAgICAgIGkuaCA9IGkuc2Nyb2xsQmFyQ29udGFpbmVyLm9mZnNldEhlaWdodDtcbiAgICAgICAgICAgIGkuc0ggPSBpLndyYXBwZXIuc2Nyb2xsSGVpZ2h0O1xuICAgICAgICAgICAgaS5zUCA9IChpLmgvaS5zSCkgKiAxMDA7XG4gICAgICAgICAgICAvLyBpLnNiaCBpcyBzY3JvbGwgYmFyIGhlaWdodCBpbiBwaXhlbHMgd2l0aG91dCBwaXhlbCB1bml0LlxuICAgICAgICAgICAgaS5zYmggPSBpLnNQICogaS5oLzEwMDtcbiAgICAgICAgICAgIC8vIE1hbnVhbGx5IHNldCB0aGUgaGVpZ2h0IG9mIHRoZSBzY3JvbGxiYXIgKGluIHBlcmNlbnRhZ2UpXG4gICAgICAgICAgICAvLyBpZiB1c2VyIGhhc24ndCBwcm92aWRlZCB0aGUgZml4ZWQgc2Nyb2xsIGhlaWdodCB2YWx1ZVxuICAgICAgICAgICAgaWYoIXEuc0gpIGkuc1AxID0gaS5zYmggPCBxLm1IPyAocS5tSC9pLmggKiAxMDApOiBpLnNQO1xuICAgICAgICAgICAgZWxzZSBpLnNQMSA9IHEuc0gvaS5oICogMTAwO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpLnJQMSA9IDEwMCAtIGkuc1AxO1xuICAgICAgICAgICAgaS54ID0gKGkuc0ggLSBpLmgpICogKChpLnNQMSAtIGkuc1ApLygxMDAgLSBpLnNQKSk7XG4gICAgICAgICAgICBpLnNIMSA9IE1hdGguYWJzKChpLnggLyAoaS5yUDEpKSArIChpLnNILzEwMCkpO1xuICAgICAgICAgICAgaS5zY3JvbGxCYXIuc3R5bGUuaGVpZ2h0ID0gaS5zUDEgKyB1bml0O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpLnJlcG9zaXRpb24gPSBnZXRSZXBvc2l0aW9uKGkuc2Nyb2xsQmFyLCBpLmgpO1xuICAgICAgICB9LFxuICAgICAgICAvLyBTdGFydCBvZiBwcml2YXRlIGZ1bmN0aW9uc1xuICAgICAgICBzZXRBdHRyID0gZnVuY3Rpb24oZSwgcCwgdil7XG4gICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShwLHYpO1xuICAgICAgICB9LFxuICAgICAgICBnZXRBdHRyID0gZnVuY3Rpb24oZSwgcCl7XG4gICAgICAgICAgICBpZighZSkgcmV0dXJuO1xuICAgICAgICAgICAgcmV0dXJuIGUuZ2V0QXR0cmlidXRlKHApOyAgICAgICAgICAgIFxuICAgICAgICB9LFxuICAgICAgICBhZGRDbGFzcyA9IGZ1bmN0aW9uKGUsIGMpe1xuICAgICAgICAgICAgaWYoYy5sZW5ndGgpIGUuY2xhc3NOYW1lID0gYztcbiAgICAgICAgfSxcbiAgICAgICAgY0UgPSBmdW5jdGlvbihjLCBoLCBwKXtcbiAgICAgICAgICAgIHZhciBkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICBhZGRDbGFzcyhkLCBjKTtcbiAgICAgICAgICAgIGQuaW5uZXJIVE1MID0gaDtcbiAgICAgICAgICAgIHAuYXBwZW5kQ2hpbGQoZCk7XG4gICAgICAgICAgICByZXR1cm4gZDtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0U2Nyb2xsID0gZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICB2YXIgZSA9IGUgfHwgZXZlbnQsZWwgPSBlLnRhcmdldCxcbiAgICAgICAgICAgICAgICBwID0gZWxbcEVdO1xuICAgICAgICAgICAgdmFyIHEgPSBpLkU7XG5cbiAgICAgICAgICAgIGlmKCFpIHx8IHAgPT09IGkuc2Nyb2xsQmFyQ29udGFpbmVyKSByZXR1cm47XG4gICAgICAgICAgICB2YXIgZVkgPSBlLnBhZ2VZIHx8IGV2ZW50LmNsaWVudFksXG4gICAgICAgICAgICAgICAgdG9wID0gKChlWSAtIGdldFRvcChpLndyYXBwZXJbcEVdKSkvaS5oICogMTAwKSAtIGkuc1AxLzI7XG4gICAgICAgICAgICBpZih0b3AgPiBpLnJQMSkgdG9wID0gaS5yUDE7XG4gICAgICAgICAgICBlbHNlIGlmKHRvcCA8IDApIHRvcCA9IDA7XG4gICAgICAgICAgICBpLnNjcm9sbEJhci5zdHlsZS50b3AgPSB0b3AgKyB1bml0O1xuICAgICAgICAgICAgaS53cmFwcGVyW3NUXSA9IHRvcCAqIGkuc0gxO1xuICAgICAgICAgICAgYWRkQ2xhc3MoaS5zY3JvbGxCYXJDb250YWluZXIsIHEuUyArIHEuYSk7XG4gICAgICAgIH0sXG4gICAgICAgIGJlZ2luU2Nyb2xsID0gZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAvLyByZW1vdmluZyBzZWxlY3RlZCB0ZXh0XG4gICAgICAgICAgICAvLyBMaW5rOiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8zMTcxMzQ4XG4gICAgICAgICAgICB2YXIgc2VsID0gd2luZG93LmdldFNlbGVjdGlvbiA/IHdpbmRvdy5nZXRTZWxlY3Rpb24oKSA6IGRvY3VtZW50LnNlbGVjdGlvbjtcbiAgICAgICAgICAgIGlmIChzZWwpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2VsLnJlbW92ZUFsbFJhbmdlcykgc2VsLnJlbW92ZUFsbFJhbmdlcygpO1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNlbC5lbXB0eSkgc2VsLmVtcHR5KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgZSA9IGUgfHwgZXZlbnQsXG4gICAgICAgICAgICAgICAgZWwgPSBlLmN1cnJlbnRUYXJnZXQ7XG5cbiAgICAgICAgICAgIGFkZEV2ZW50KCdtb3VzZW1vdmUnLCBkb2N1bWVudCwgbW92ZVNjcm9sbCk7XG4gICAgICAgICAgICBhZGRFdmVudCgnbW91c2V1cCcsIGRvY3VtZW50LCBlbmRTY3JvbGwpO1xuXG4gICAgICAgICAgICBpW29UXSA9IGdldFRvcChpLndyYXBwZXIpO1xuICAgICAgICAgICAgaS5maXJzdFkgPSBlLnBhZ2VZIHx8IGV2ZW50LmNsaWVudFk7XG4gICAgICAgICAgICBpZighaS5yZXBvc2l0aW9uKSBpLnJlcG9zaXRpb24gPSBnZXRSZXBvc2l0aW9uKGkuc2Nyb2xsQmFyLCBpLmgpO1xuICAgICAgICAgICAgLy8gRGlzYWJsZSB0ZXh0IHNlbGVjdGlvbiB3aGlsZSBkcmFnZ2luZyB0aGUgc2Nyb2xsYmFyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0sXG4gICAgICAgIGdldFJlcG9zaXRpb24gPSBmdW5jdGlvbihpLCBoKXtcbiAgICAgICAgICAgIHZhciB4ID0gcGFyc2VJbnQoaS5zdHlsZS50b3AucmVwbGFjZSh1bml0LFwiXCIpLDEwKSAqIGgvMTAwO1xuICAgICAgICAgICAgcmV0dXJuIHg/eDowO1xuICAgICAgICB9LFxuICAgICAgICBtb3ZlU2Nyb2xsID0gZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICB2YXIgZSA9IGUgfHwgZXZlbnQsXG4gICAgICAgICAgICAgICAgcSA9IGkuRSxcbiAgICAgICAgICAgICAgICBlWSA9IGUucGFnZVkgfHwgZS5jbGllbnRZLFxuICAgICAgICAgICAgICAgIHRvcCA9IChpLnJlcG9zaXRpb24gKyBlWSAtIGkuZmlyc3RZKS9pLmggKiAxMDA7XG5cbiAgICAgICAgICAgIGlmKGkuclAxIDwgdG9wKSB0b3AgPSBpLnJQMTtcbiAgICAgICAgICAgIGlmKCFpLnByZXZpb3VzVG9wKSBpLnByZXZpb3VzVG9wID0gdG9wICsgMTtcbiAgICAgICAgICAgIHZhciBibG5UaHJlc2hvbGQgPSB0b3AgPj0gMCAmJiBpLmZpcnN0WSA+IGlbb1RdO1xuICAgICAgICAgICAgaWYoKGkucHJldmlvdXNUb3AgPiB0b3AgJiYgYmxuVGhyZXNob2xkKSB8fCAoYmxuVGhyZXNob2xkICYmIChpLndyYXBwZXJbc1RdICsgaS5oICE9PSBpLnNIKSkpe1xuICAgICAgICAgICAgICAgIGkuc2Nyb2xsQmFyLnN0eWxlLnRvcCA9IHRvcCArIHVuaXQ7XG4gICAgICAgICAgICAgICAgaS5wcmV2aW91c1RvcCA9IHRvcDsgICBcbiAgICAgICAgICAgICAgICBpLndyYXBwZXJbc1RdID0gdG9wICogaS5zSDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhZGRDbGFzcyhpLnNjcm9sbEJhckNvbnRhaW5lciwgcS5TKTtcbiAgICAgICAgfSxcbiAgICAgICAgZW5kU2Nyb2xsID0gZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICB2YXIgZSA9IGUgfHwgZXZlbnQscSA9IGkuRTsgXG5cbiAgICAgICAgICAgIHJlbW92ZUV2ZW50KCdtb3VzZW1vdmUnLCBkb2N1bWVudCk7XG4gICAgICAgICAgICByZW1vdmVFdmVudCgnbW91c2V1cCcsIGRvY3VtZW50KTtcblxuICAgICAgICAgICAgaS5yZXBvc2l0aW9uID0gMDtcbiAgICAgICAgICAgIGFkZENsYXNzKGkuc2Nyb2xsQmFyQ29udGFpbmVyLCBxLlMgKyBxLmEpO1xuICAgICAgICB9LFxuICAgICAgICBkb1Njcm9sbCA9IGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgdmFyIGUgPSBlIHx8IGV2ZW50O1xuICAgICAgICAgICAgaWYoIWkpIHJldHVybjtcbiAgICAgICAgICAgIHZhciBxID0gaS5FO1xuICAgICAgICAgICAgYWRkQ2xhc3MoaS5zY3JvbGxCYXJDb250YWluZXIsIHEuUyk7XG4gICAgICAgICAgICBpLnNjcm9sbEJhci5zdHlsZS50b3AgPSBpLndyYXBwZXJbc1RdL2kuc0gxICsgdW5pdDtcbiAgICAgICAgICAgIGFkZENsYXNzKGkuc2Nyb2xsQmFyQ29udGFpbmVyLCBxLlMgKyBxLmEpO1xuICAgICAgICB9LFxuICAgICAgICBhZGRFdmVudCA9IGZ1bmN0aW9uKGUsIGVsLCBmdW5jKXtcbiAgICAgICAgICAgIGVsWydvbicgKyBlXSA9IGZ1bmM7XG4gICAgICAgICAgICAvLyBlbC5hZGRFdmVudExpc3RlbmVyKGUsIGZ1bmMsIGZhbHNlKTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVtb3ZlRXZlbnQgPSBmdW5jdGlvbihlLCBlbCl7XG4gICAgICAgICAgICBlbFsnb24nICsgZV0gPSBudWxsO1xuICAgICAgICAgICAgLy8gZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihlLCBmdW5jLCBmYWxzZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGFkZENTU1J1bGUgPSBmdW5jdGlvbihTLCBzLCByLCBpKSB7XG4gICAgICAgICAgICBpZihTLmluc2VydFJ1bGUpIFMuaW5zZXJ0UnVsZShzICsgXCJ7XCIgKyByICsgXCJ9XCIsIGkpO1xuICAgICAgICAgICAgZWxzZSBpZihTLmFkZFJ1bGUpIFMuYWRkUnVsZShzLCByLCBpKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0VG9wID0gZnVuY3Rpb24oZWwpe1xuICAgICAgICAgICAgdmFyIHQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnRbc1RdO1xuICAgICAgICAgICAgcmV0dXJuIGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCArICh0P3Q6ZG9jdW1lbnQuYm9keVtzVF0pO1xuICAgICAgICB9LFxuICAgICAgICBpbnNlcnRDc3MgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgaWYoc2xpbVNjcm9sbC5pbnNlcnRlZCl7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gSW5zZXJ0aW5nIGNzcyBydWxlc1xuICAgICAgICAgICAgLy8gTGluazogaHR0cDovL2Rhdmlkd2Fsc2gubmFtZS9hZGQtcnVsZXMtc3R5bGVzaGVldHNcbiAgICAgICAgICAgIHZhciBzbGltID0gXCJbXCIrbCtcIl1cIixcbiAgICAgICAgICAgICAgICBpbXAgPSBcIiAhaW1wb3J0YW50XCIsXG4gICAgICAgICAgICAgICAgcEEgPSBcInBvc2l0aW9uOmFic29sdXRlXCIraW1wLFxuICAgICAgICAgICAgICAgIC8vIGNsYXNzZXNcbiAgICAgICAgICAgICAgICB3ID0gcEErXCI7b3ZlcmZsb3c6YXV0b1wiK2ltcCtcIjtsZWZ0OjBweDt0b3A6MHB4XCIraW1wK1wiO3JpZ2h0Oi0xOHB4O2JvdHRvbTowcHhcIitpbXArXCI7cGFkZGluZy1yaWdodDo4cHhcIitpbXArXCI7XCIsXG4gICAgICAgICAgICAgICAgUyA9IHBBK1wiO3RvcDowcHhcIitpbXArXCI7Ym90dG9tOjBweFwiK2ltcCtcIjtyaWdodDowcHg7bGVmdDphdXRvO3dpZHRoOjVweDtjdXJzb3I6cG9pbnRlclwiK2ltcCtcIjtwYWRkaW5nLXJpZ2h0OjBweFwiK2ltcCtcIjtcIixcbiAgICAgICAgICAgICAgICBzID0gcEErXCI7YmFja2dyb3VuZC1jb2xvcjojOTk5O3RvcDowcHg7bGVmdDowcHg7cmlnaHQ6MHB4O1wiLFxuICAgICAgICAgICAgICAgIC8vY3JlYXRpbmcgYSBzaGVldFxuICAgICAgICAgICAgICAgIHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKSxcbiAgICAgICAgICAgICAgICBzY3JvbGxCYXIgPSBcIltkYXRhLXNjcm9sbGJhcl1cIjtcbiAgICAgICAgICAgIHRyeXtcbiAgICAgICAgICAgICAgICAvLyBXZWJLaXQgaGFjayA6KFxuICAgICAgICAgICAgICAgIHN0eWxlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKFwiXCIpKTtcbiAgICAgICAgICAgIH1jYXRjaChleCl7fVxuICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIgaGVhZCA9ICBkb2N1bWVudC5oZWFkIHx8IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkJylbMF07XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBhZGRpbmcgYWJvdmUgY3NzIHRvIHRoZSBzaGVldFxuICAgICAgICAgICAgaGVhZC5pbnNlcnRCZWZvcmUoc3R5bGUsIChoZWFkLmhhc0NoaWxkTm9kZXMoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBoZWFkLmNoaWxkTm9kZXNbMF1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBudWxsKTtcbiAgICAgICAgICAgIHZhciBzaGVldCA9IHN0eWxlLnNoZWV0O1xuICAgICAgICAgICAgaWYoc2hlZXQpeyAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBhZGRDU1NSdWxlKHNoZWV0LCBzbGltK1wiPmRpdlwiLCB3LCAwKTtcbiAgICAgICAgICAgICAgICBhZGRDU1NSdWxlKHNoZWV0LCBzbGltK1wiPmRpditkaXZcIiwgUywgMCk7XG4gICAgICAgICAgICAgICAgYWRkQ1NTUnVsZShzaGVldCwgc2Nyb2xsQmFyLCBzLCAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2V7XG4gICAgICAgICAgICAgICAgc3R5bGUuc3R5bGVTaGVldC5jc3NUZXh0ID0gc2xpbStcIj5kaXZ7XCIrdytcIn1cIitzbGltK1wiPmRpditkaXZcIitcIntcIitTK1wifVwiK3NsaW0rXCI+ZGl2K2Rpdj5kaXZ7XCIrcytcIn1cIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNsaW1TY3JvbGwuaW5zZXJ0ZWQgPSB0cnVlO1xuICAgICAgICB9LFxuICAgICAgICAvLyBJbml0aWFsIGZ1bmN0aW9uXG4gICAgICAgIGluaXQgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgQy5yZW1vdmVBdHRyaWJ1dGUobCk7ICAvL3Jlc2V0XG4gICAgICAgICAgICBpZihDLm9mZnNldEhlaWdodCA8IEMuc2Nyb2xsSGVpZ2h0KXtcbiAgICAgICAgICAgICAgICBzZXRBdHRyKEMsIGwsICcxJyk7XG4gICAgICAgICAgICAgICAgaW5zZXJ0Q3NzKCk7XG4gICAgICAgICAgICAgICAgdmFyIGggPSBDLmlubmVySFRNTCwgcSA9IGkuRSA9IHt9O1xuICAgICAgICAgICAgICAgIC8vIHNldHRpbmcgdXNlciBkZWZpbmVkIGNsYXNzZXNcbiAgICAgICAgICAgICAgICBwYXlsb2FkID0gcGF5bG9hZCB8fCB7fTtcbiAgICAgICAgICAgICAgICBxLncgPSBwYXlsb2FkLndyYXBwZXJDbGFzcyB8fCBcIlwiO1xuICAgICAgICAgICAgICAgIHEucyA9IHBheWxvYWQuc2Nyb2xsQmFyQ2xhc3MgfHwgXCJcIjtcbiAgICAgICAgICAgICAgICBxLlMgPSBwYXlsb2FkLnNjcm9sbEJhckNvbnRhaW5lckNsYXNzIHx8IFwiXCI7XG4gICAgICAgICAgICAgICAgcS5hID0gcGF5bG9hZC5zY3JvbGxCYXJDb250YWluZXJTcGVjaWFsQ2xhc3MgPyBcIiBcIiArIHBheWxvYWQuc2Nyb2xsQmFyQ29udGFpbmVyU3BlY2lhbENsYXNzIDogXCJcIjtcbiAgICAgICAgICAgICAgICBxLm1IID0gcGF5bG9hZC5zY3JvbGxCYXJNaW5IZWlnaHQgfHwgMjU7XG4gICAgICAgICAgICAgICAgcS5zSCA9IHBheWxvYWQuc2Nyb2xsQmFyRml4ZWRIZWlnaHQ7ICAvLyBjb3VsZCBiZSB1bmRlZmluZWRcblxuICAgICAgICAgICAgICAgIEMuaW5uZXJIVE1MID0gXCJcIjtcbiAgICAgICAgICAgICAgICBpLndyYXBwZXIgPSBjRShxLncsIGgsIEMpO1xuICAgICAgICAgICAgICAgIGkuc2Nyb2xsQmFyQ29udGFpbmVyID0gY0UocS5TICsgcS5hLCBcIlwiLCBDKTtcbiAgICAgICAgICAgICAgICBpLnNjcm9sbEJhciA9IGNFKHEucywgXCJcIiwgaS5zY3JvbGxCYXJDb250YWluZXIpO1xuICAgICAgICAgICAgICAgIHNldEF0dHIoaS5zY3JvbGxCYXIsICdkYXRhLXNjcm9sbGJhcicsICcxJyk7XG4gICAgICAgICAgICAgICAgYXNzaWduVmFsdWVzKCk7XG5cbiAgICAgICAgICAgICAgICBpZihwYXlsb2FkLmtlZXBGb2N1cyl7XG4gICAgICAgICAgICAgICAgICAgIHNldEF0dHIoaS53cmFwcGVyLCAndGFiaW5kZXgnLCAnLTEnKTtcbiAgICAgICAgICAgICAgICAgICAgaS53cmFwcGVyLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIEF0dGFjaGluZyBtb3VzZSBldmVudHNcbiAgICAgICAgICAgICAgICBhZGRFdmVudCgnbW91c2Vkb3duJywgaS5zY3JvbGxCYXIsIGJlZ2luU2Nyb2xsKTtcbiAgICAgICAgICAgICAgICBhZGRFdmVudCgnY2xpY2snLCBpLnNjcm9sbEJhckNvbnRhaW5lciwgc2V0U2Nyb2xsKTtcbiAgICAgICAgICAgICAgICAvLyBGb3Igc2Nyb2xsXG4gICAgICAgICAgICAgICAgYWRkRXZlbnQoJ3Njcm9sbCcsIGkud3JhcHBlciwgZG9TY3JvbGwpO1xuICAgICAgICAgICAgICAgIC8vIGFkZEV2ZW50KCdzZWxlY3RzdGFydCcsIGkuc2Nyb2xsQmFyQ29udGFpbmVyLCBmdW5jdGlvbigpe3JldHVybjt9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSgpO1xuICAgIHJldHVybiB7XG4gICAgICAgIHJlc2V0VmFsdWVzOiBhc3NpZ25WYWx1ZXNcbiAgICB9XG59O1xuXG5leHBvcnQgeyBzbGltU2Nyb2xsIH07Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
